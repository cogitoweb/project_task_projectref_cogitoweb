<?xml version="1.0" encoding="utf-8"?>
<openerp>
   <data>
      <record model="ir.ui.view" id="project_task_projectref_view_form">
         <field name="name">project.task.project_ref.form</field>
         <field name="model">project.task</field>
         <field name="priority">20</field>
         <field name="inherit_id" ref="project.view_task_form2"></field>
         <field name="arch" type="xml">
             
            <field name="reviewer_id" position="after">
                <field name="points"/>
            </field>
            
            <field name="user_id" position="attributes">
				<attribute name="domain">"[('groups_id.id', '=', %(base.group_user)d)]"</attribute>
			</field>

            <xpath expr="//field[@name='work_ids']/tree/field[@name='user_id']" position="attributes">
                <attribute name="domain">"[('groups_id.id', '=', %(base.group_user)d)]"</attribute>
            </xpath>

			<field name="reviewer_id" position="attributes">
				<attribute name="domain">"[('groups_id.id', '=', %(base.group_user)d)]"</attribute>
			</field>
             
            <field name="project_id" position="after">
                <field name="project_ref_id">Project reference</field>
            </field>
             
            <field name="project_id" position="attributes">
                <attribute name="required">True</attribute>
            </field>

            <field name="date_deadline" position="attributes">
                <attribute name="required">True</attribute>
            </field>

            <field name="company_id" position="attributes">
                <attribute name="invisible">True</attribute>
            </field>

            <field name="an_acc_by_prj" invisible="True"></field>
            <field name="an_acc_by_prj_ref" invisible="True" ></field>

            <field name="sale_line_id" position="replace"></field>
            <field name="partner_id" position="replace"></field>

            <xpath expr="//page[@string='Extra Info']">
                <page string="Accounting">

                    <group>
                        <group>
                            <field name="partner_id" />
                            <field name="sale_line_id" options="{'no_quick_create':True,'no_create_edit':True}"
                            domain="['&amp;', ('order_id.project_id', '!=', False), '|', ('order_id.project_id', '=', an_acc_by_prj_ref), ('order_id.project_id', '=', an_acc_by_prj)]" />
                        </group>
                        <group>
                            <field name="price" />
                            <field name="cost" />
                            <field name="effective_cost" />
                        </group>
                    </group>
                    <group>
                        <group>
                            <field name="invoiced" />
                        </group>
                        <group>
                            <field name="invoice_date" />
                            <field name="invoice_amount" />
                        </group>
                    </group>

                </page>
            </xpath>

        </field>
      </record>

   </data>
</openerp>