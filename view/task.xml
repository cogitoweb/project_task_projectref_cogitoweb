<?xml version="1.0" encoding="utf-8"?>
<openerp>
   <data>
      <record model="ir.ui.view" id="project_task_projectref_view_form">
         <field name="name">project.task.project_ref.form</field>
         <field name="model">project.task</field>
         <field name="priority">20</field>
         <field name="inherit_id" ref="project.view_task_form2"></field>
         <field name="arch" type="xml">
             
            <field name="reviewer_id" position="after">
                <field name="points"/>
            </field>
            
            <field name="user_id" position="attributes">
				<attribute name="domain">"[('groups_id.id', '=', %(base.group_user)d)]"</attribute>
			</field>

            <xpath expr="//field[@name='work_ids']/tree/field[@name='user_id']" position="attributes">
                <attribute name="domain">"[('groups_id.id', '=', %(base.group_user)d)]"</attribute>
            </xpath>

			<field name="reviewer_id" position="attributes">
				<attribute name="domain">"[('groups_id.id', '=', %(base.group_user)d)]"</attribute>
			</field>
             
            <field name="project_id" position="after">
                <field name="project_ref_id">Project reference</field>
            </field>
             
            <field name="project_id" position="attributes">
                <attribute name="required">True</attribute>
            </field>
             
            <field name="sale_line_id" position="after">
                <field name="price">Price</field>
            </field>
             
            <field name="sale_line_id" position="after">
                <field name="cost">Cost</field> 
            </field>
             
             <field name="sale_line_id" position="after">
                <field name="effective_cost">Effective Cost</field> 
            </field>
             
            <field name="company_id" position="attributes">
                <attribute name="readonly">True</attribute>
            </field>
             
            <field name="date_deadline" position="attributes">
                <attribute name="required">True</attribute>
            </field>

            <field name="company_id" position="after">
                    <field name="an_acc_by_prj" invisible="True"></field>
                    <field name="an_acc_by_prj_ref" invisible="True" ></field>
            </field>
             
            <field name="sale_line_id" position="attributes">
                <attribute name="options">{'no_quick_create':True,'no_create_edit':True}</attribute>    
                
                <attribute name="domain">['&amp;', ('order_id.project_id', '!=', False), '|',
                    ('order_id.project_id', '=', an_acc_by_prj_ref), ('order_id.project_id', '=', an_acc_by_prj)]</attribute>
                
            </field>

        </field>
      </record>

      <record model="ir.ui.view" id="project_task_projectref_search_form">
         <field name="name">project.task.project_ref.search_form</field>
         <field name="model">project.task</field>
         <field name="priority">60</field>
         <field name="inherit_id" ref="project.view_task_search_form"></field>
         <field name="arch" type="xml">

            <field name="stage_id" position="after">
                <filter name="active_tasks" string="Active Tasks" domain="[('stage_id','not in',(7,8))]"/>
            </field>

    	</field>
     </record>
   
     <record id="project_form_schedule_tasks" model="ir.actions.act_window">
            <field name="name">Schedule project tasks</field>
            <field name="res_model">project.task</field>
            <field name="view_mode">gantt,tree,form,graph</field>
            <field name="context">{'search_default_active_tasks': 1, 'search_default_project_id': [active_id],'default_project_id': active_id,'active_test': False}</field>
            <field name="search_view_id" ref="project.view_task_search_form"/>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
              </p>
            </field>
        </record>



   </data>
</openerp>
